<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Quality of Life</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<script>
//indicators function

function showLocation(clickedLayer, event) {
  var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
  var button = event.target;
  
  if (visibility === 'visible') {
    map.setLayoutProperty(clickedLayer, 'visibility', 'none');
    button.className = '';
  } else {
    button.className = 'active';
    map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
  }
}


</script>
<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<style>
     .map-overlay {
        position: absolute;
        bottom: 0;
        right: 0;
        margin-right: 20px;
        font-family: INHERIT;
        overflow: auto;
        color:white
      }
    #features {
        top: 0;
        height: 400px;
        margin-top: 20px;
        width: 300px;
    }
    input[type="radio"] {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-color: #F4F1DE;
        width: 10px;
        height: 10px;
    }
    input[type="radio"]:checked {
        background-color: #0A578F;
        border: 2px solid #F4F1DE;
    }
    label {
        color:#F4F1DE;
        padding: 2px;
        font-family:monospace;
    }
    #legend {
        padding: 10px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        line-height: 18px;
        height: 250px;
        margin-bottom: 20px;
        width: 60px;
        font-family:monospace;
    }
    .legend-key {
        display: inline-block;
        border-radius: 20%;
        width: 10px;
        height: 10px;
        margin-right: 5px;
    }
    button {
        margin: 2px;
        padding: 2px;
        border: none;
        font-size: inherit;
        cursor: pointer;
        background-color:#0A578F;
        color: #F4F1DE;
        font-family:monospace;
    }
    button.active {
        background-color: #F4F1DE;
        color: #0A578F;
        margin: 2px;
        padding: 2px;
        border: none;
        font-size: inherit;
        cursor: pointer;
    }
    .button:hover {
        margin: 2px;
        padding: 2px;
        border: none;
        font-size: inherit;
        cursor: pointer;
        background-color:#0A578F;
        color: #F4F1DE;
        font-family:monospace;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
        
    }
    

</style>


<div id="map"></div>
<div class="map-overlay" id="features">
    <h1> Quality of Life</h1>
    <div id="menu">
        <h2>Year</h2>
        <div class='row' id='filters'>
            
            <input id='2016' type='radio' name='toggle' value='2016'>
            <label for='2016'>2016</label>
            <input id='2017' type='radio' name='toggle' value='2017'>
            <label for='2017'>2017</label>
            <input id='2018' type='radio' name='toggle' value='2018'>
            <label for='2018'>2018</label>
            <input id='2019' type='radio' name='toggle' value='2019'>
            <label for='2019'>2019</label>
            <input id='2020' type='radio' name='toggle' value='2020'>
            <label for='2020'>2020</label>
            <br><br>
            <input id='no' type='radio' name='toggle' value='0' checked='checked'>
            <label for='no'>Clear</label>
          </div>
    </div>
    <div id="indicators">
        <h2>Indicators</h2>
            <div class='row2, id='choose'>
              <button onclick="showLocation('gym', event)" class='active'>Gym</button>
              <button onclick="showLocation('police', event)" class='active'>Police Station</button>
              <button onclick="showLocation('high_school', event)" class='active'>High School</button>
              <button onclick="showLocation('primary_school', event)" class='active'>Primary School</button>
              <button onclick="showLocation('fire_station', event)" class='active'>Fire Station</button>
              <button onclick="showLocation('hospital', event)" class='active'>Hospital</button>
              <button onclick="showLocation('government_sector', event)" class='active'>Government Sector</button>
            </div>
    </div>
</div>

<div class="map-overlay" id="legend"></div>
<script>
	mapboxgl.accessToken = 'pk.eyJ1IjoidHMyM21lZyIsImEiOiJjbGpsbXd3MXgwdnphM2VrMjI4OWUzN2h4In0.C14aWUGcGvOoJEs-IqQ_nw';
    const map = new mapboxgl.Map({
        container: 'map',
        // map style URL from Mapbox Studio
        style: 'mapbox://styles/ts23meg/cll9e0f2f00oz01pm1dadgl0a',
        zoom: 9,
        center: [121.61584748102158, 25.029704391775606]
    });
    
    map.on('load', () => {
        const layers = map.getStyle().layers;
        // Find the index of the first symbol layer in the map style.
        let symbolAll;
        for (const layer of layers) {
        if (layer.type === 'symbol') {
        symbolAll = layer.id;
        break;
        }};
        
        
        map.addSource('cluster', {
            type: 'vector',
            url: 'mapbox://ts23meg.8mq28wjx'
        });
        
        map.addLayer({
                "id": "105",
                "type": "fill",
                "paint": {
                  "fill-color": [
                    "step",
                    [
                      "get",
                      "combine_cl"
                    ],
                    "#0e5d63",
                    1,
                    "#3b8d76",
                    2,
                    "#193d40",
                    3,
                    "#7f625e",
                    4,
                    "#f2cc8f",
                    5,
                    "#2b83ba",
                    6,
                    "#bc9478",
                    7,
                    "#bf7b7b",
                    8,
                    "#81b29a",
                    9,
                    "#426656",
                    10,
                    "#9d4d55",
                    11,
                    "#9e597d",
                    12,
                    "#56a1b3"
                  ],
                  "fill-opacity": 0.83,
                  "fill-outline-color": [
                    "interpolate",
                    [
                      "linear"
                    ],
                    [
                      "get",
                      "combine_cl"
                    ],
                    0,
                    "#000000",
                    12,
                    "#000000"
                  ]
                },
                "layout": {},
                "source": "cluster",
                "source-layer": "result-9gfcho"

              }, symbolAll);
              
        map.addLayer({
                "id": "106",
                "type": "fill",
                "paint": {
                  "fill-color": [
                    "step",
                    [
                      "get",
                      "combine__1"
                    ],
                    "#0e5d63",
                    1,
                    "#3b8d76",
                    2,
                    "#193d40",
                    3,
                    "#7f625e",
                    4,
                    "#f2cc8f",
                    5,
                    "#2b83ba",
                    6,
                    "#bc9478",
                    7,
                    "#bf7b7b",
                    8,
                    "#81b29a",
                    9,
                    "#426656",
                    10,
                    "#9d4d55",
                    11,
                    "#9e597d",
                    12,
                    "#56a1b3"
                  ],
                  "fill-opacity": 0.83,
                  "fill-outline-color": [
                    "interpolate",
                    [
                      "linear"
                    ],
                    [
                      "get",
                      "combine__1"
                    ],
                    0,
                    "#000000",
                    12,
                    "#000000"
                  ]
                },
                "layout": {},
                "source": "cluster",
                "source-layer": "result-9gfcho"

              }, symbolAll);
              
        map.addLayer({
                "id": "107",
                "type": "fill",
                "paint": {
                  "fill-color": [
                    "step",
                    [
                      "get",
                      "combine__2"
                    ],
                    "#0e5d63",
                    1,
                    "#3b8d76",
                    2,
                    "#193d40",
                    3,
                    "#7f625e",
                    4,
                    "#f2cc8f",
                    5,
                    "#2b83ba",
                    6,
                    "#bc9478",
                    7,
                    "#bf7b7b",
                    8,
                    "#81b29a",
                    9,
                    "#426656",
                    10,
                    "#9d4d55",
                    11,
                    "#9e597d",
                    12,
                    "#56a1b3"
                  ],
                  "fill-opacity": 0.83,
                  "fill-outline-color": [
                    "interpolate",
                    [
                      "linear"
                    ],
                    [
                      "get",
                      "combine__2"
                    ],
                    0,
                    "#000000",
                    12,
                    "#000000"
                  ]
                },
                "layout": {},
                "source": "cluster",
                "source-layer": "result-9gfcho"

              }, symbolAll);
        map.addLayer({
                "id": "108",
                "type": "fill",
                "paint": {
                  "fill-color": [
                    "step",
                    [
                      "get",
                      "combine__3"
                    ],
                    "#0e5d63",
                    1,
                    "#3b8d76",
                    2,
                    "#193d40",
                    3,
                    "#7f625e",
                    4,
                    "#f2cc8f",
                    5,
                    "#2b83ba",
                    6,
                    "#bc9478",
                    7,
                    "#bf7b7b",
                    8,
                    "#81b29a",
                    9,
                    "#426656",
                    10,
                    "#9d4d55",
                    11,
                    "#9e597d",
                    12,
                    "#56a1b3"
                  ],
                  "fill-opacity": 0.83,
                  "fill-outline-color": [
                    "interpolate",
                    [
                      "linear"
                    ],
                    [
                      "get",
                      "combine__3"
                    ],
                    0,
                    "#000000",
                    12,
                    "#000000"
                  ]
                },
                "layout": {},
                "source": "cluster",
                "source-layer": "result-9gfcho"

              }, symbolAll);
        map.addLayer({
                "id": "109",
                "type": "fill",
                "paint": {
                  "fill-color": [
                    "step",
                    [
                      "get",
                      "combine__4"
                    ],
                    "#0e5d63",
                    1,
                    "#3b8d76",
                    2,
                    "#193d40",
                    3,
                    "#7f625e",
                    4,
                    "#f2cc8f",
                    5,
                    "#2b83ba",
                    6,
                    "#bc9478",
                    7,
                    "#bf7b7b",
                    8,
                    "#81b29a",
                    9,
                    "#426656",
                    10,
                    "#9d4d55",
                    11,
                    "#9e597d",
                    12,
                    "#56a1b3"
                  ],
                  "fill-opacity": 0.83,
                  "fill-outline-color": [
                    "interpolate",
                    [
                      "linear"
                    ],
                    [
                      "get",
                      "combine__4"
                    ],
                    0,
                    "#000000",
                    12,
                    "#000000"
                  ]
                },
                "layout": {},
                "source": "cluster",
                "source-layer": "result-9gfcho"

              }, symbolAll);
        
        document.getElementById('filters').addEventListener('change', (event) => {
          const year = event.target.value;
          // update the map filter
          if (year === '2016') {
            map.setLayoutProperty('105', 'visibility', 'visible');
            map.setLayoutProperty('106', 'visibility', 'none');
            map.setLayoutProperty('107', 'visibility', 'none');
            map.setLayoutProperty('108', 'visibility', 'none');
            map.setLayoutProperty('109', 'visibility', 'none');
          } else if (year === '2017') {
            map.setLayoutProperty('106', 'visibility', 'visible');
            map.setLayoutProperty('105', 'visibility', 'none');
            map.setLayoutProperty('107', 'visibility', 'none');
            map.setLayoutProperty('108', 'visibility', 'none');
            map.setLayoutProperty('109', 'visibility', 'none');
          } else if (year === '2018') {
            map.setLayoutProperty('107', 'visibility', 'visible');
            map.setLayoutProperty('105', 'visibility', 'none');
            map.setLayoutProperty('106', 'visibility', 'none');
            map.setLayoutProperty('108', 'visibility', 'none');
            map.setLayoutProperty('109', 'visibility', 'none');
          } else if (year === '2019') {
            map.setLayoutProperty('108', 'visibility', 'visible');
            map.setLayoutProperty('105', 'visibility', 'none');
            map.setLayoutProperty('107', 'visibility', 'none');
            map.setLayoutProperty('106', 'visibility', 'none');
            map.setLayoutProperty('109', 'visibility', 'none');
          } else if (year === '2020') {
            map.setLayoutProperty('109', 'visibility', 'visible');
            map.setLayoutProperty('105', 'visibility', 'none');
            map.setLayoutProperty('107', 'visibility', 'none');
            map.setLayoutProperty('106', 'visibility', 'none');
            map.setLayoutProperty('108', 'visibility', 'none');
          } else {
            map.setLayoutProperty('109', 'visibility', 'none');
            map.setLayoutProperty('105', 'visibility', 'none');
            map.setLayoutProperty('107', 'visibility', 'none');
            map.setLayoutProperty('108', 'visibility', 'none');
            map.setLayoutProperty('106', 'visibility', 'none');
          } 
          });
          
        // define layer names
        const clusters = [
          '0',
          '1',
          '2',
          '3',
          '4',
          '5',
          '6',
          '7',
          '8',
          '9',
          '10',
          '11',
          '12',
        ];
        const colors = [
          '#2b83ba',
          '#56a1b3',
          '#81b29a',
          '#426656',
          '#193d40',
          '#0e5d63',
          '#3b8d76',
          '#bf7b7b',
          '#9e597d',
          '#9d4d55',
          '#7f625e',
          '#bc9478',
          '#f2cc8f'
        ];
        
        const mid = [
            [[121.46518, 25.00201], 12],
            [[121.5053, 25.04069], 12],
            [[121.5151, 25.0510], 12],
            [[121.5180, 25.0510], 12.5],
            [[121.4758, 25.0408], 12],
            [[121.4849, 25.0402], 12],
            [[121.5536, 25.0671], 11],
            [[121.4734, 25.0471], 11],
            [[121.4849, 25.0371], 11],
            [[121.5890, 25.0867], 10],
            [[121.5432, 25.0772], 10],
            [[121.6484, 25.0481], 9.6],
            [[121.664, 24.9725], 9.6],
        ]
        // create legend
        const legend = document.getElementById('legend');

        clusters.forEach((layeri, i) => {
          const color = colors[i];
          const item = document.createElement('div');
          item.style.cursor= 'pointer';
          const key = document.createElement('span');
          key.className = 'legend-key';
          key.style.backgroundColor = color;

          const value = document.createElement('span');
          value.innerHTML = `${layeri}`;
          item.appendChild(key);
          item.appendChild(value);
          legend.appendChild(item);
          

          item.onclick = () => {

            const targetCoordinates = mid[i][0]; // 修改為你想要移動的座標
        

            map.flyTo({
              center: targetCoordinates,
              zoom: mid[i][1],
              speed: 0.8, 
            });
          };
        
          item.appendChild(key);
          item.appendChild(value);
          legend.appendChild(item);
        });
        
        // add indicators
        
        const sources = [
        'mapbox://ts23meg.cll9krwvc1jt72cs6etr3vdul-6r2n2', 
        'mapbox://ts23meg.cll9ksc1r17vx2ct5oxm8earg-7t0rz',
        'mapbox://ts23meg.cll9krhpo03ek2qlk79webltt-27rda',
        'mapbox://ts23meg.cll9kr7900nsj2hntqi19rzps-3a05e',
        'mapbox://ts23meg.cll9kqt6x0nsg2hnttord3nbv-5foib',
        'mapbox://ts23meg.cll9kq96i0rxt2onufipf2ben-0xyku',
        'mapbox://ts23meg.cll9kpx6o03ew2clkpakhqm0o-6dxrt',
        ];
        
        const name = [
        'gym',
        'police',
        'high_school',
        'primary_school',
        'fire_station',
        'hospital',
        'government_sector'
        ]
        
        const icons = [
        'basketball',
        'police',
        'college',
        'college',
        'fire-station',
        'hospital',
        'museum'
        ]
        
        name.forEach((keyid, i) => {
        map.addSource(keyid, {
            type: 'vector',
            url: sources[i]
        });
        
        map.addLayer({
            'id': keyid,
            'type': 'symbol',
            'source': keyid,
            'source-layer': keyid,
            'layout': {
              'icon-image': icons[i],
              'icon-allow-overlap': true
            },
            'paint': {}
          });
                
        });
        
    
        
        
    });

    
</script>

</body>
</html>

